{% extends "layout.html" %}

{% block title %}Add Recipe{% endblock %}
{% block page %}Add Recipe{% endblock %}

{% block content %}
<style>
  body {
    background-color: #9a2a2a;
  }
  
  .recipe-form-container {
    max-width: 1000px;
    margin: 30px auto;
    padding: 20px 40px 40px 40px;
  }
  
  .form-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 30px;
  }
  
  .form-header h2 {
    color: #fff;
    font-size: 28px;
    font-weight: 600;
    margin: 0;
  }
  
  .add-recipe-btn {
    background-color: #430a0a;
    border: none;
    color: white;
    padding: 12px 25px;
    border-radius: 25px;
    font-weight: bold;
    font-size: 16px;
    text-transform: uppercase;
    cursor: pointer;
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
    display: flex;
    align-items: center;
    justify-content: center;
  }
  
  .input-row {
    display: flex;
    gap: 20px;
    margin-bottom: 20px;
  }
  
  .input-field {
    flex: 1;
  }
  
  .input-field input, .input-field textarea, .input-field select {
    width: 100%;
    padding: 15px;
    border: none;
    border-radius: 25px;
    background-color: #e9b3b3;
    color: #2c3e50;
    font-size: 16px;
  }
  
  .input-field input::placeholder, .input-field textarea::placeholder {
    color: #4f0000;  /* Darker red for more contrast */
    opacity: 0.9;    /* Higher opacity for better visibility */
    font-weight: 600; /* Make it slightly bolder */
  }
  
  .input-field label {
    display: block;
    color: #fff;     /* White text for highest contrast */
    font-size: 16px;
    margin-bottom: 5px;
    font-weight: 600;
  }
  
  .section-container {
    display: flex;
    gap: 20px;
    margin-top: 30px;
  }
  
  .section {
    flex: 1;
    background-color: #d58c8c;
    border-radius: 15px;
    padding: 20px;
    min-height: 350px;
  }
  
  .section h3 {
    color: #2c3e50;
    margin-top: 0;
    margin-bottom: 20px;
    font-size: 20px;
  }
  
  .ingredient-row {
    display: flex;
    gap: 10px;
    margin-bottom: 15px;
    align-items: center;
  }
  
  .ingredient-input {
    flex: 2;
  }
  
  .measurement-input {
    flex: 1;
  }
  
  .ingredient-select {
    flex: 1.5;
  }
  
  .add-btn {
    width: 36px;
    height: 36px;
    border-radius: 50%;
    background-color: #430a0a;
    border: none;
    color: white;
    font-size: 20px;
    display: flex;
    justify-content: center;
    align-items: center;
    cursor: pointer;
    flex-shrink: 0;
  }
  
  .directions-container textarea {
    width: 100%;
    height: 200px;
    background-color: #e9b3b3;
    border: none;
    border-radius: 15px;
    padding: 15px;
    resize: vertical;
    font-size: 16px;
  }
</style>

<div class="recipe-form-container">
  <div class="form-header">
    <h2>Add Recipe:</h2>
    <button type="submit" form="recipeForm" class="add-recipe-btn">Add Recipe</button>
  </div>

  <form id="recipeForm" method="POST" action="{{ url_for('recipe_views.add_recipe_action') }}" enctype="multipart/form-data">
    <input type="hidden" name="user_id" value="{{ current_user.id }}">
    
    <div class="input-field">
      <input type="text" id="title" name="title" placeholder="Name:" required>
    </div>
    
    <div class="input-row">
      <div class="input-field">
        <input type="url" id="recipe_url" name="recipe_url" placeholder="Recipe URL:">
      </div>
      <div class="input-field">
        <input type="url" id="image_url" name="image_url" placeholder="Image URL:">
      </div>
    </div>
    
    <div class="input-field">
      <input type="text" id="cook_time" name="cook_time" placeholder="Cook Time (e.g., 30 minutes):" required>
    </div>
    
    <div class="input-field">
      <textarea id="description" name="description" placeholder="Description:" required></textarea>
    </div>
    
    <div class="section-container">
      <div class="section">
        <h3>Ingredients:</h3>
        <div id="ingredientsContainer">
          <div class="ingredient-row">
            <select name="ingredient_category_0" class="ingredient-select">
              <option value="">Type of Ingredients</option>
              <option value="produce">Produce</option>
              <option value="dairy">Dairy</option>
              <option value="spices">Herbs/Spices</option>
              <option value="meat">Meat</option>
              <option value="pantry">Pantry</option>
            </select>
            <button type="button" class="add-btn">+</button>
          </div>
          <div class="ingredient-row">
            <input type="text" name="ingredient_name_0" class="ingredient-input" placeholder="Ingredients text" required>
            <button type="button" class="add-btn">+</button>
          </div>
          <div class="ingredient-row">
            <input type="number" name="ingredient_quantity_0" class="measurement-input" placeholder="Amount" required min="0" step="0.25">
            <select name="ingredient_unit_0" class="measurement-input">
              <option value="unit">unit</option>
              <option value="cup">cup</option>
              <option value="teaspoon">teaspoon</option>
              <option value="Tablespoon">Tablespoon</option>
              <option value="pound">pound</option>
              <option value="ounce">ounce</option>
              <option value="gram">gram</option>
              <option value="ml">ml</option>
            </select>
            <button type="button" class="add-btn">+</button>
          </div>
        </div>
        <button type="button" id="addIngredient" class="add-btn" style="margin-top: 15px;">+</button>
      </div>
      
      <div class="section">
        <h3>Directions:</h3>
        <div class="directions-container">
          <textarea id="instructions" name="instructions" placeholder="Directions text" required></textarea>
          <button type="button" class="add-btn" style="margin-top: 10px;">+</button>
        </div>
      </div>
    </div>
  </form>
</div>

<script>
  document.addEventListener('DOMContentLoaded', function() {
    let ingredientCounter = 1;
    
    // Main add ingredient button (adds complete set of fields)
    document.getElementById('addIngredient').addEventListener('click', function() {
      addIngredientSet();
    });
    
    // Individual + buttons
    document.addEventListener('click', function(event) {
      // Check if the clicked element is a + button
      if (event.target.classList.contains('add-btn')) {
        const parentRow = event.target.closest('.ingredient-row');
        
        // Don't process the main add button we already handled
        if (event.target.id === 'addIngredient') return;
        
        // For the directions + button
        if (event.target.closest('.directions-container')) {
          addDirectionsField();
          return;
        }
        
        // For ingredient row buttons
        if (parentRow) {
          // Determine which type of row it is
          if (parentRow.querySelector('.ingredient-select')) {
            addIngredientTypeField();
          } else if (parentRow.querySelector('.ingredient-input')) {
            addIngredientNameField();
          } else if (parentRow.querySelector('.measurement-input')) {
            addMeasurementField();
          }
        }
      }
    });
    
    // Function to add a complete set of ingredient fields
    function addIngredientSet() {
      const container = document.getElementById('ingredientsContainer');
      
      // Create category row
      const categoryRow = document.createElement('div');
      categoryRow.className = 'ingredient-row';
      categoryRow.innerHTML = `
        <select name="ingredient_category_${ingredientCounter}" class="ingredient-select" required>
          <option value="">Type of Ingredients</option>
          <option value="produce">Produce</option>
          <option value="dairy">Dairy</option>
          <option value="spices">Herbs/Spices</option>
          <option value="meat">Meat</option>
          <option value="pantry">Pantry</option>
        </select>
        <button type="button" class="add-btn">+</button>
      `;
      container.appendChild(categoryRow);
      
      // Create name row
      const nameRow = document.createElement('div');
      nameRow.className = 'ingredient-row';
      nameRow.innerHTML = `
        <input type="text" name="ingredient_name_${ingredientCounter}" class="ingredient-input" placeholder="Ingredients text" required>
        <button type="button" class="add-btn">+</button>
      `;
      container.appendChild(nameRow);
      
      // Create measurement row
      const measurementRow = document.createElement('div');
      measurementRow.className = 'ingredient-row';
      measurementRow.innerHTML = `
        <input type="number" name="ingredient_quantity_${ingredientCounter}" class="measurement-input" placeholder="Amount" required min="0" step="0.25">
        <select name="ingredient_unit_${ingredientCounter}" class="measurement-input">
          <option value="unit">unit</option>
          <option value="cup">cup</option>
          <option value="teaspoon">teaspoon</option>
          <option value="Tablespoon">Tablespoon</option>
          <option value="pound">pound</option>
          <option value="ounce">ounce</option>
          <option value="gram">gram</option>
          <option value="ml">ml</option>
        </select>
        <button type="button" class="add-btn">+</button>
      `;
      container.appendChild(measurementRow);
      
      ingredientCounter++;
    }
    
    // Function to add just an ingredient type field
    function addIngredientTypeField() {
      const container = document.getElementById('ingredientsContainer');
      const newRow = document.createElement('div');
      newRow.className = 'ingredient-row';
      newRow.innerHTML = `
        <select name="ingredient_category_extra_${Math.random().toString(36).substring(2, 9)}" class="ingredient-select">
          <option value="">Type of Ingredients</option>
          <option value="produce">Produce</option>
          <option value="dairy">Dairy</option>
          <option value="spices">Herbs/Spices</option>
          <option value="meat">Meat</option>
          <option value="pantry">Pantry</option>
        </select>
        <button type="button" class="add-btn">+</button>
      `;
      container.appendChild(newRow);
    }
    
    // Function to add just an ingredient name field
    function addIngredientNameField() {
      const container = document.getElementById('ingredientsContainer');
      const newRow = document.createElement('div');
      newRow.className = 'ingredient-row';
      newRow.innerHTML = `
        <input type="text" name="ingredient_name_extra_${Math.random().toString(36).substring(2, 9)}" class="ingredient-input" placeholder="Ingredients text">
        <button type="button" class="add-btn">+</button>
      `;
      container.appendChild(newRow);
    }
    
    // Function to add just a measurement field
    function addMeasurementField() {
      const container = document.getElementById('ingredientsContainer');
      const newRow = document.createElement('div');
      newRow.className = 'ingredient-row';
      newRow.innerHTML = `
        <input type="number" name="ingredient_quantity_extra_${Math.random().toString(36).substring(2, 9)}" class="measurement-input" placeholder="Amount" min="0" step="0.25">
        <select name="ingredient_unit_extra_${Math.random().toString(36).substring(2, 9)}" class="measurement-input">
          <option value="unit">unit</option>
          <option value="cup">cup</option>
          <option value="teaspoon">teaspoon</option>
          <option value="Tablespoon">Tablespoon</option>
          <option value="pound">pound</option>
          <option value="ounce">ounce</option>
          <option value="gram">gram</option>
          <option value="ml">ml</option>
        </select>
        <button type="button" class="add-btn">+</button>
      `;
      container.appendChild(newRow);
    }
    
    // Function to add additional directions field
    function addDirectionsField() {
      const directionsContainer = document.querySelector('.directions-container');
      const newTextarea = document.createElement('textarea');
      newTextarea.name = 'additional_instructions';
      newTextarea.placeholder = 'Additional directions...';
      newTextarea.style.marginTop = '10px';
      directionsContainer.insertBefore(newTextarea, directionsContainer.lastElementChild);
    }
  });
</script>
{% endblock %}